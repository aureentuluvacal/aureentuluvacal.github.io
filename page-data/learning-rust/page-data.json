{
    "componentChunkName": "component---src-templates-blog-post-js",
    "path": "/learning-rust/",
    "result": {"data":{"site":{"siteMetadata":{"title":"Cal Perez"}},"markdownRemark":{"id":"0195c549-8b55-5b41-9ea6-ae102e2cee1a","excerpt":"I’m taking a break from Maxwell’s Equations to talk about something else I’ve done recently: learned Rust. I’m mostly taking a break because it takes me like…","timeToRead":7,"html":"<p>I’m taking a break from Maxwell’s Equations to talk about something else I’ve done recently: learned Rust. I’m mostly taking a break because it takes me like 7 years to create all the diagrams for those posts.</p>\n<p>But anyhoo, what is Rust?</p>\n<p>According to Wikipedia, Rust “is a multi-paradigm systems programming language focused on safety, especially safe concurrency”.</p>\n<p>Cool.</p>\n<p>At first, that meant nothing to me since my only frame of reference was Ruby, Javascript, and — unfortunately — PHP, but as I slowly learned the language using <a href=\"https://doc.rust-lang.org/book/\">“The Book”</a>, the pieces started to fall into place. Let’s talk about them.</p>\n<h2>Systems programming</h2>\n<p>Systems programming languages are used to program systems. But what does that mean? And what qualifies a language to make it meant for systems programming?</p>\n<p>“Systems” is a term reserved for things like operating systems, kernels, compilers, game engines, drivers, and other “platforms” that we can run other programs on. Systems interact directly with hardware, and in the context of computers, rely on the OS to facilitate the manipulation of hardware.</p>\n<p>On the other side of systems are applications and the user. We, as users, directly interface with apps, which interface with systems, which interface with hardware.</p>\n<p>Rust is just another language, like C and C++, that we can use to program the things that interact with your hardware. There’s even a kernel written in Rust called <a href=\"https://www.redox-os.org/\">Redox</a>.</p>\n<p>So then what are the qualifiers for a language to program something like an operating system?</p>\n<p>If we defined a systems programming language as a language that we use to interact directly with hardware, then only assembly languages would count because the programmers at the time had only themselves and a dumb box of hardware.</p>\n<p>Every language from there would just be abstractions away from the hardware.</p>\n<p><img src=\"https://s3.us-east-2.amazonaws.com/caryssa-perez-images/posts/hierarchy-of-languages.png\" alt=\"Hierarchy of programming languages\"></p>\n<p>On the far left we have hardware, which is ultimately what our programs operate on. Then there’s machine language, binaries that the hardware can understand and run. All programs eventually compile down to machine language. If we go up a layer in abstraction, we get to assembly languages, which are the first human readable programming languages tailored specifically to their respective types of hardware. Each line in an assembly program represents an actual operation that the computer does (and a massive amount of machine language). Rust, C, and Javascript are another abstraction up. They represent the high-level languages, where the code is even more undertstandable than assembly and represents an even more massive amount of binary.</p>\n<p>As we progress in the levels of abstraction, we’re basically asking, <em>How can we represent this state in a smaller, simpler way</em>? So how can we represent patterns in our hardware, our state machine? Binaries. How can we represent patterns in our binaries in a smaller, simpler way? With assembly languages. How can we represent patterns in our assembly in a smaller, simpler way? With high-level languages.</p>\n<p>Naturally, as we get more and more abstract, we have to rely on more under the hood, which decreases speed and performance.</p>\n<p><img src=\"https://s3.us-east-2.amazonaws.com/caryssa-perez-images/posts/systems-languages.png\" alt=\"Hierarchy of programming languages\"></p>\n<p>Systems programming languages need to be fast, like an assembly language or C, so languages like Ruby and Javascript don’t quite cut it. They also need to be directly compilable to machine language or binary. Ruby and Javascript rely on an intermediate stage before they’re compiled to machine language.</p>\n<p>Rust is both fast and directly compiled to binary, making it a systems programming language.</p>\n<h2>Memory safety</h2>\n<p>Rust’s compiler is a stickler for memory safe code. Let’s take a look at an example.</p>\n<div class=\"gatsby-highlight\" data-language=\"rust\"><pre class=\"language-rust\"><code class=\"language-rust\"><span class=\"token keyword\">fn</span> <span class=\"token function-definition function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> v <span class=\"token operator\">=</span> <span class=\"token macro property\">vec!</span><span class=\"token punctuation\">[</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token macro property\">println!</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"{}\"</span><span class=\"token punctuation\">,</span> v<span class=\"token punctuation\">[</span><span class=\"token number\">10</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>We have a <code class=\"language-text\">main()</code> function that is the entrypoint for every Rust program, like the main method in Java or C. At compile time, the compiler throws an error because we’re trying to access an out of bounds index. C or C++ would just try to give you whatever the corresponding value was at that place in memory even if the value didn’t belong to the vector.</p>\n<p>Rust also has two baked in features called <strong>Ownership</strong> and <strong>Borrowing</strong> that help make Rust code more memory safe.</p>\n<h3>Ownership</h3>\n<p>Let’s continue with the same basic example above.</p>\n<div class=\"gatsby-highlight\" data-language=\"rust\"><pre class=\"language-rust\"><code class=\"language-rust\"><span class=\"token keyword\">fn</span> <span class=\"token function-definition function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> v <span class=\"token operator\">=</span> <span class=\"token macro property\">vec!</span><span class=\"token punctuation\">[</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token macro property\">println!</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"{}\"</span><span class=\"token punctuation\">,</span> v<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>We have our vector variable <code class=\"language-text\">v</code> that has three elements in it. Those three elements are <em>owned by</em> <code class=\"language-text\">v</code> and when <code class=\"language-text\">v</code> goes out of scope, its three elements get deallocated in memory.</p>\n<div class=\"gatsby-highlight\" data-language=\"rust\"><pre class=\"language-rust\"><code class=\"language-rust\"><span class=\"token keyword\">fn</span> <span class=\"token function-definition function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> v <span class=\"token operator\">=</span> <span class=\"token macro property\">vec!</span><span class=\"token punctuation\">[</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token macro property\">println!</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"{}\"</span><span class=\"token punctuation\">,</span> v<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span> <span class=\"token comment\">// v goes out of scope, so do the values it owns.</span></code></pre></div>\n<p>In the context of passing arguments to functions, we’ll see <strong>Ownership</strong> where it’s most valuable. Let’s say I had my <code class=\"language-text\">main()</code> function that calls another function named <code class=\"language-text\">print_first_value()</code></p>\n<div class=\"gatsby-highlight\" data-language=\"rust\"><pre class=\"language-rust\"><code class=\"language-rust\"><span class=\"token keyword\">fn</span> <span class=\"token function-definition function\">print_first_value</span><span class=\"token punctuation\">(</span>vector<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Vec</span><span class=\"token operator\">&lt;</span><span class=\"token keyword\">i32</span><span class=\"token operator\">></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token macro property\">println!</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"{}\"</span><span class=\"token punctuation\">,</span> vector<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">fn</span> <span class=\"token function-definition function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> v <span class=\"token operator\">=</span> <span class=\"token macro property\">vec!</span><span class=\"token punctuation\">[</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token function\">print_first_value</span><span class=\"token punctuation\">(</span>v<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token macro property\">println!</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"{}\"</span><span class=\"token punctuation\">,</span> v<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>When a variable is passed to a function, the function takes ownership of the variable. In this case, <code class=\"language-text\">v</code> would be owned by <code class=\"language-text\">print_first_value()</code> and made available in <code class=\"language-text\">print_first_value()</code>’s scope. This code wouldn’t compile because I’m trying to use <code class=\"language-text\">v</code> in the <code class=\"language-text\">main()</code> function’s scope.</p>\n<p>We could rewrite it this way:</p>\n<div class=\"gatsby-highlight\" data-language=\"rust\"><pre class=\"language-rust\"><code class=\"language-rust\"><span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> v <span class=\"token operator\">=</span> <span class=\"token macro property\">vec!</span><span class=\"token punctuation\">[</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// v belongs to main.</span>\n\n  <span class=\"token function\">print_first_value</span><span class=\"token punctuation\">(</span>v<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">// Transfer of ownership.</span>\n    <span class=\"token macro property\">println!</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"{}\"</span><span class=\"token punctuation\">,</span> v<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// v belongs to print_first_value.</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token comment\">// v goes out of scope.</span>\n\n  <span class=\"token comment\">// Trying to access v, which has gone out of scope.</span>\n  <span class=\"token macro property\">println!</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"{}\"</span><span class=\"token punctuation\">,</span> v<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>There’s definitely more to <strong>Ownership</strong>, but even in this small example, we can see how it helps keeps your code honest; your functions can change what they own without worrying about weird side effects.</p>\n<p>However, there may be moments when you may want to perform several operations on the same value or collection. If each function takes ownership of your value, then how can you chain operations on it? This is where <strong>Borrowing</strong> comes in.</p>\n<h3>Borrowing</h3>\n<p>If I wanted to perform several operations on <code class=\"language-text\">v</code> then I would let my functions borrow the value in <code class=\"language-text\">v</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"rust\"><pre class=\"language-rust\"><code class=\"language-rust\"><span class=\"token comment\">// I know this example is contrived.</span>\n\n<span class=\"token keyword\">fn</span> <span class=\"token function-definition function\">print_first_value</span><span class=\"token punctuation\">(</span>vector<span class=\"token punctuation\">:</span> <span class=\"token operator\">&amp;</span><span class=\"token class-name\">Vec</span><span class=\"token operator\">&lt;</span><span class=\"token keyword\">i32</span><span class=\"token operator\">></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token macro property\">println!</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"{}\"</span><span class=\"token punctuation\">,</span> vector<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">fn</span> <span class=\"token function-definition function\">print_size</span><span class=\"token punctuation\">(</span>vector<span class=\"token punctuation\">:</span> <span class=\"token operator\">&amp;</span><span class=\"token class-name\">Vec</span><span class=\"token operator\">&lt;</span><span class=\"token keyword\">i32</span><span class=\"token operator\">></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token macro property\">println!</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"The size of my vector is: {}\"</span><span class=\"token punctuation\">,</span> vector<span class=\"token punctuation\">.</span><span class=\"token function\">len</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">fn</span> <span class=\"token function-definition function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> v <span class=\"token operator\">=</span> <span class=\"token macro property\">vec!</span><span class=\"token punctuation\">[</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token function\">print_first_value</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>v<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">print_size</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>v<span class=\"token punctuation\">)</span>\n\n    <span class=\"token macro property\">println!</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"{}\"</span><span class=\"token punctuation\">,</span> v<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Using the <code class=\"language-text\">&amp;</code> operator, I can pass a reference to <code class=\"language-text\">v</code> into <code class=\"language-text\">print_first_value()</code> and <code class=\"language-text\">print_size()</code>. Since both functions are borrowing the value of <code class=\"language-text\">v</code>, they don’t take ownership, and I’m free to continue using <code class=\"language-text\">v</code> in the <code class=\"language-text\">main()</code> function.</p>\n<p>If we excluded the <code class=\"language-text\">&amp;</code> in the arguments for both functions, the compiler would throw an error. <strong>Borrowing</strong> is baked into the compiler just like <strong>Ownership</strong>, and when used in tandem, they give you more granular control of the memory in your program.</p>\n<h2>Safe concurrency</h2>\n<p>Concurrency in Rust is safe thanks to <strong>Ownership</strong> and <strong>Borrowing</strong>. Before I get into why, I want to dive a little into what concurrency means.</p>\n<p>Sometimes you may want to split out the functionality of your code into multiple threads. Threads are independent tasks that run concurrently in a process. A process is what runs your code in the first place.</p>\n<p>For example, you may want to write a super fast multi-threaded server. Each connection between a client and your server would live on a separate thread, while your server runs on a single process. If threads didn’t exist in this example, the connections would occur sequentially, which would impact performance.</p>\n<p>Rust gives you tools to write multi-threaded code and attempts to steer you away from common pitfalls in multi-threaded programming, including:</p>\n<blockquote>\n<ul>\n<li>Race conditions, where threads are accessing data or resources in an inconsistent order</li>\n<li>Deadlocks, where two threads are waiting for each other to finish using a resource the other thread has, preventing both threads from continuing</li>\n<li>Bugs that happen only in certain situations and are hard to reproduce and fix reliably</li>\n</ul>\n<p><em>Source: <a href=\"https://doc.rust-lang.org/stable/book/ch16-01-threads.html\">the Rust book</a></em></p>\n</blockquote>\n<p>The compiler’s <strong>Ownership</strong> and <strong>Borrowing</strong> rules are also applied in your multi-threaded code and they prevent you from using variables that one thread has ownership of and the others do not.</p>\n<h2>Why Rust?</h2>\n<p>There were two reasons why I was drawn to Rust: (1) it’s <a href=\"https://rustwasm.github.io/docs/book/\">compilable to WebAssembly</a> and (2) it’s the new hotness. (I’m not ashamed to admit #2). I’ve wanted to mess around with WASM for a while so I’ve started a very small project called Synesthete.</p>\n<p>Like the name suggests it’s about <a href=\"https://en.wikipedia.org/wiki/Synesthesia\">synesthesia</a>, particularly seeing colors when visualizing numbers. Still need to design it, but the general idea is you’d map all digits (0-9) to a color, type out a bunch of random numbers, and see what it looks like with the palette you chose.</p>\n<p>This is <em>probably</em> not the use case for WASM but no one can stop me.</p>\n<h2>More Rust resources</h2>\n<ul>\n<li><a href=\"https://www.rust-lang.org/\">Rust homepage</a></li>\n<li><a href=\"https://blog.rust-lang.org/2015/04/10/Fearless-Concurrency.html\">More about safe concurrency</a></li>\n<li><a href=\"https://doc.rust-lang.org/book/\">The Rust Book</a></li>\n<li><a href=\"https://medium.com/@bugaevc/understanding-rust-ownership-borrowing-lifetimes-ff9ee9f79a9c\">More on Ownership and Borrowing</a></li>\n</ul>","frontmatter":{"title":"I Learned Rust!","date":"March 25, 2019","description":"I'm taking a break from Maxwell's Equations to talk about something else I've done recently: learned Rust.","subtitle":null,"tags":["Code"]}}},"pageContext":{"slug":"/learning-rust/","previous":{"fields":{"slug":"/faradays-law-of-induction/"},"frontmatter":{"title":"Maxwell's Equations","subtitle":"Faraday's Law of Induction"}},"next":{"fields":{"slug":"/troubleshooting-db-cpu-error/"},"frontmatter":{"title":"Troubleshooting Rails Database Connection Issue","subtitle":null}}}},
    "staticQueryHashes": ["3000541721"]}